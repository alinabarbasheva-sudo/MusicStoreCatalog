<UserControl x:Class="MusicStoreCatalog.Pages.ReportsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:MusicStoreCatalog.Pages"
             Height="700" Width="1000">

    <UserControl.Resources>
        <!-- Конвертер для рейтинга звезд -->
        <local:RatingToVisibilityConverter x:Key="RatingConverter"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20" Background="White">

            <!-- Заголовок -->
            <Border Background="#2c3e50" Padding="20" CornerRadius="8" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="📊 АНАЛИТИЧЕСКИЕ ОТЧЕТЫ" 
                               Foreground="White" 
                               FontSize="24" 
                               FontWeight="Bold"/>
                    <TextBlock Text="Статистика и аналитика магазина музыкальных инструментов" 
                               Foreground="#ecf0f1" 
                               FontSize="14" 
                               Margin="0,5,0,0"/>
                    <TextBlock x:Name="ReportDateText" 
                               Foreground="#bdc3c7" 
                               FontSize="12" 
                               Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <!-- Кнопки управления -->
            <Border Background="#f8f9fa" Padding="15" CornerRadius="8" Margin="0,0,0,20">
                <WrapPanel>
                    <Button x:Name="RefreshBtn" 
                            Content="🔄 Обновить данные" 
                            Padding="12,8" 
                            Margin="0,0,10,5"
                            FontWeight="SemiBold"
                            Background="#3498db"
                            Foreground="White"
                            Click="RefreshBtn_Click"/>

                    <ComboBox x:Name="PeriodCombo" 
                              Width="150" 
                              Margin="0,0,10,5"
                              SelectedIndex="0"
                              SelectionChanged="PeriodCombo_SelectionChanged">
                        <ComboBoxItem Content="За сегодня"/>
                        <ComboBoxItem Content="За неделю"/>
                        <ComboBoxItem Content="За месяц"/>
                        <ComboBoxItem Content="За все время"/>
                    </ComboBox>
                </WrapPanel>
            </Border>

            <!-- Ряд 1: Ключевые метрики -->
            <TextBlock Text="📈 КЛЮЧЕВЫЕ ПОКАЗАТЕЛИ" 
                       FontSize="18" 
                       FontWeight="Bold" 
                       Margin="0,0,0,15"/>

            <WrapPanel Margin="0,0,0,20">
                <!-- Карточка 1 -->
                <Border Background="White" 
                        BorderBrush="#ddd" 
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Width="230"
                        Height="120"
                        Margin="0,0,15,15">
                    <StackPanel>
                        <TextBlock Text="💰 Общая стоимость склада" 
                                   Foreground="#7f8c8d" 
                                   FontSize="12"/>
                        <TextBlock x:Name="TotalStockValue" 
                                   Text="0 br" 
                                   FontSize="28" 
                                   FontWeight="Bold"
                                   Foreground="#2c3e50"
                                   Margin="0,5,0,0"/>
                        <TextBlock Text="Стоимость всех инструментов на складе" 
                                   FontSize="10" 
                                   Foreground="#95a5a6"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Карточка 2 -->
                <Border Background="White" 
                        BorderBrush="#ddd" 
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Width="230"
                        Height="120"
                        Margin="0,0,15,15">
                    <StackPanel>
                        <TextBlock Text="🎵 Всего инструментов" 
                                   Foreground="#7f8c8d" 
                                   FontSize="12"/>
                        <TextBlock x:Name="TotalInstruments" 
                                   Text="0" 
                                   FontSize="28" 
                                   FontWeight="Bold"
                                   Foreground="#2c3e50"
                                   Margin="0,5,0,0"/>
                        <TextBlock x:Name="InstrumentsByCategory" 
                                   Text="по категориям" 
                                   FontSize="11" 
                                   Foreground="#95a5a6"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Карточка 3 -->
                <Border Background="White" 
                        BorderBrush="#ddd" 
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Width="230"
                        Height="120"
                        Margin="0,0,15,15">
                    <StackPanel>
                        <TextBlock Text="👥 Активные консультанты" 
                                   Foreground="#7f8c8d" 
                                   FontSize="12"/>
                        <TextBlock x:Name="ActiveConsultants" 
                                   Text="0" 
                                   FontSize="28" 
                                   FontWeight="Bold"
                                   Foreground="#2c3e50"
                                   Margin="0,5,0,0"/>
                        <TextBlock x:Name="TopConsultant" 
                                   Text="Лучший: -" 
                                   FontSize="11" 
                                   Foreground="#95a5a6"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Карточка 4 -->
                <Border Background="White" 
                        BorderBrush="#ddd" 
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20"
                        Width="230"
                        Height="120"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="📋 Активные заявки" 
                                   Foreground="#7f8c8d" 
                                   FontSize="12"/>
                        <TextBlock x:Name="PendingOrders" 
                                   Text="0" 
                                   FontSize="28" 
                                   FontWeight="Bold"
                                   Foreground="#2c3e50"
                                   Margin="0,5,0,0"/>
                        <TextBlock x:Name="OrdersStatus" 
                                   Text="0 подтверждено, 0 отклонено" 
                                   FontSize="11" 
                                   Foreground="#95a5a6"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>
            </WrapPanel>

            <!-- Ряд 2: Статистика продаж -->
            <Border Background="White" 
                    BorderBrush="#ddd" 
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="📊 ПРОДАЖИ ПО КОНСУЛЬТАНТАМ" 
                               FontSize="18" 
                               FontWeight="Bold"
                               Margin="0,0,0,15"/>

                    <ListView x:Name="SalesByConsultantList" 
                              Height="300"
                              ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Консультант" Width="180">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ConsultantName}" 
                                                       FontWeight="SemiBold"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Специализация" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Specialization}"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Продажи" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="#2ecc71" 
                                                    CornerRadius="4" 
                                                    Padding="6,2"
                                                    HorizontalAlignment="Left">
                                                <TextBlock Text="{Binding SalesCount}" 
                                                           Foreground="White"
                                                           FontWeight="Bold"
                                                           HorizontalAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Рейтинг" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="★" 
                                                           Foreground="#f39c12"
                                                           FontSize="14"
                                                           Visibility="{Binding Rating, Converter={StaticResource RatingConverter}, ConverterParameter=1}"/>
                                                <TextBlock Text="★" 
                                                           Foreground="#f39c12"
                                                           FontSize="14"
                                                           Visibility="{Binding Rating, Converter={StaticResource RatingConverter}, ConverterParameter=2}"/>
                                                <TextBlock Text="★" 
                                                           Foreground="#f39c12"
                                                           FontSize="14"
                                                           Visibility="{Binding Rating, Converter={StaticResource RatingConverter}, ConverterParameter=3}"/>
                                                <TextBlock Text="★" 
                                                           Foreground="#f39c12"
                                                           FontSize="14"
                                                           Visibility="{Binding Rating, Converter={StaticResource RatingConverter}, ConverterParameter=4}"/>
                                                <TextBlock Text="★" 
                                                           Foreground="#f39c12"
                                                           FontSize="14"
                                                           Visibility="{Binding Rating, Converter={StaticResource RatingConverter}, ConverterParameter=5}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Эффективность" Width="150">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <ProgressBar Value="{Binding SalesCount}" 
                                                         Maximum="50" 
                                                         Height="10"
                                                         Width="120"
                                                         Margin="5,0,0,0">
                                                <ProgressBar.Style>
                                                    <Style TargetType="ProgressBar">
                                                        <Setter Property="Foreground" Value="#2ecc71"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding SalesCount}" Value="50">
                                                                <Setter Property="Foreground" Value="#27ae60"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding SalesCount}" Value="40">
                                                                <Setter Property="Foreground" Value="#2ecc71"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding SalesCount}" Value="30">
                                                                <Setter Property="Foreground" Value="#f39c12"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding SalesCount}" Value="20">
                                                                <Setter Property="Foreground" Value="#e67e22"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding SalesCount}" Value="10">
                                                                <Setter Property="Foreground" Value="#e74c3c"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ProgressBar.Style>
                                            </ProgressBar>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>

                    <TextBlock Text="Рейтинг: ★ (0-9) ★★ (10-19) ★★★ (20-29) ★★★★ (30-39) ★★★★★ (40+)" 
                               FontSize="11" 
                               Foreground="#95a5a6"
                               Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <!-- Ряд 3: Статистика по заявкам -->
            <Border Background="White" 
                    BorderBrush="#ddd" 
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="📋 СТАТИСТИКА ЗАЯВОК" 
                               FontSize="18" 
                               FontWeight="Bold"
                               Margin="0,0,0,15"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Статистика 1 -->
                        <Border Grid.Column="0" 
                                Background="#e8f6f3" 
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,10,0">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="⏳ В ожидании" 
                                           FontSize="14" 
                                           Foreground="#16a085"/>
                                <TextBlock x:Name="PendingCount" 
                                           Text="0" 
                                           FontSize="36" 
                                           FontWeight="Bold"
                                           Foreground="#16a085"
                                           Margin="0,5,0,0"/>
                                <TextBlock Text="заявок" 
                                           FontSize="12" 
                                           Foreground="#1abc9c"/>
                            </StackPanel>
                        </Border>

                        <!-- Статистика 2 -->
                        <Border Grid.Column="1" 
                                Background="#e8f8f5" 
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,10,0">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="✅ Подтверждено" 
                                           FontSize="14" 
                                           Foreground="#27ae60"/>
                                <TextBlock x:Name="ApprovedCount" 
                                           Text="0" 
                                           FontSize="36" 
                                   FontWeight="Bold"
                                   Foreground="#27ae60"
                                   Margin="0,5,0,0"/>
                                <TextBlock x:Name="ApprovedQuantity" 
                                           Text="0 шт. инструментов" 
                                           FontSize="12" 
                                           Foreground="#2ecc71"/>
                            </StackPanel>
                        </Border>

                        <!-- Статистика 3 -->
                        <Border Grid.Column="2" 
                                Background="#fdedec" 
                                CornerRadius="8"
                                Padding="20">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="❌ Отклонено" 
                                           FontSize="14" 
                                           Foreground="#e74c3c"/>
                                <TextBlock x:Name="RejectedCount" 
                                           Text="0" 
                                           FontSize="36" 
                                           FontWeight="Bold"
                                           Foreground="#e74c3c"
                                           Margin="0,5,0,0"/>
                                <TextBlock Text="заявок" 
                                           FontSize="12" 
                                           Foreground="#c0392b"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Подпись -->
            <TextBlock Text="Отчет сгенерирован автоматически. Данные обновляются в реальном времени." 
                       FontSize="11" 
                       Foreground="#95a5a6" 
                       HorizontalAlignment="Center"
                       Margin="0,20,0,0"/>

        </StackPanel>
    </ScrollViewer>

</UserControl>